






<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta http-equiv="last-modified" content="2023-03-13 20:02:32 +1100">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- meta "search-domain" used for google site search function google_search() -->
    <meta name="search-domain" value="">
    <link rel="stylesheet" type="text/css" href="../assets/css/bootstrap.css" />
    <link rel="stylesheet" type="text/css" href="../assets/css/bootstrap-theme.css" />
    <link rel="stylesheet" type="text/css" href="../assets/css/lesson.css" />
    <link rel="stylesheet" type="text/css" href="../assets/css/syntax.css" />
     <link rel="stylesheet" type="text/css" href="../assets/css/fonts.css" />
    
    <link rel="license" href="#license-info" />

    



    <!-- Favicons for everyone -->
    <link rel="apple-touch-icon-precomposed" sizes="57x57" href="../assets/favicons/incubator/apple-touch-icon-57x57.png" />
    <link rel="apple-touch-icon-precomposed" sizes="114x114" href="../assets/favicons/incubator/apple-touch-icon-114x114.png" />
    <link rel="apple-touch-icon-precomposed" sizes="72x72" href="../assets/favicons/incubator/apple-touch-icon-72x72.png" />
    <link rel="apple-touch-icon-precomposed" sizes="144x144" href="../assets/favicons/incubator/apple-touch-icon-144x144.png" />
    <link rel="apple-touch-icon-precomposed" sizes="60x60" href="../assets/favicons/incubator/apple-touch-icon-60x60.png" />
    <link rel="apple-touch-icon-precomposed" sizes="120x120" href="../assets/favicons/incubator/apple-touch-icon-120x120.png" />
    <link rel="apple-touch-icon-precomposed" sizes="76x76" href="../assets/favicons/incubator/apple-touch-icon-76x76.png" />
    <link rel="apple-touch-icon-precomposed" sizes="152x152" href="../assets/favicons/incubator/apple-touch-icon-152x152.png" />
    <link rel="icon" type="image/png" href="../assets/favicons/incubator/favicon-196x196.png" sizes="196x196" />
    <link rel="icon" type="image/png" href="../assets/favicons/incubator/favicon-96x96.png" sizes="96x96" />
    <link rel="icon" type="image/png" href="../assets/favicons/incubator/favicon-32x32.png" sizes="32x32" />
    <link rel="icon" type="image/png" href="../assets/favicons/incubator/favicon-16x16.png" sizes="16x16" />
    <link rel="icon" type="image/png" href="../assets/favicons/incubator/favicon-128.png" sizes="128x128" />
    <meta name="application-name" content="The Carpentries Incubator - Introduction to Reproducible Publications with RStudio"/>
    <meta name="msapplication-TileColor" content="#FFFFFF" />
    <meta name="msapplication-TileImage" content="../assets/favicons/incubator/mstile-144x144.png" />
    <meta name="msapplication-square70x70logo" content="../assets/favicons/incubator/mstile-70x70.png" />
    <meta name="msapplication-square150x150logo" content="../assets/favicons/incubator/mstile-150x150.png" />
    <meta name="msapplication-wide310x150logo" content="../assets/favicons/incubator/mstile-310x150.png" />
    <meta name="msapplication-square310x310logo" content="../assets/favicons/incubator/mstile-310x310.png" />


    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
	<script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
	<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
	<![endif]-->
  <title>
  Reproducible & Efficient Methods of Using Code Chunks &ndash; Introduction to Reproducible Publications with RStudio
  </title>

  </head>
  <body>
    







<div class="panel panel-default life-cycle">
  <div id="life-cycle" class="panel-body alpha">
    This lesson is in the early stages of development (Alpha version)
  </div>
</div>





    <div class="container">
      
















  
  










<nav class="navbar navbar-default">
  <div class="container-fluid">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>

      
      
      <a href="../index.html" class="pull-left">
        <img class="navbar-logo" src="../assets/img/incubator-logo-blue.svg" alt="The Carpentries Incubator logo" />
      </a>
      

      
      <a class="navbar-brand" href="../index.html">Home</a>

    </div>
    <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
      <ul class="nav navbar-nav">

	
        <li><a href="../CODE_OF_CONDUCT.html">Code of Conduct</a></li>

        
	
        <li><a href="../setup.html">Setup</a></li>

        
        
        <li class="dropdown">
          <a href="../" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">Episodes <span class="caret"></span></a>
          <ul class="dropdown-menu">
            
            
            <li><a href="../01-introduction/index.html">Scientific reproducibility: What is it for?</a></li>
            
            
            <li><a href="../02-basic-rstudio/index.html">Navigating RStudio and Quarto Documents</a></li>
            
            
            <li><a href="../03-quarto-documents/index.html">Introduction to Working with Quarto documents</a></li>
            
            
            <li><a href="../04-good-project/index.html">Good Practices for Managing Projects in RStudio</a></li>
            
            
            <li><a href="../05-setup-versioning/index.html">Getting Your project set up with Version Control in RStudio</a></li>
            
            
            <li><a href="../06-writing-styling/index.html">Writing and Styling Qmd Documents</a></li>
            
            
            <li><a href="../07-plots-figures/index.html">Adding Code-Generated Plots and Figures</a></li>
            
            
            <li><a href="../08-code-chunks/index.html">Reproducible & Efficient Methods of Using Code Chunks</a></li>
            
            
            <li><a href="../09-biblio-crossref/index.html">Bibliography, Citations & Cross-Referencing</a></li>
            
            
            <li><a href="../10-github/index.html">Collaborating via Github</a></li>
            
            
            <li><a href="../11-publishing-your-project/index.html">Publishing your project</a></li>
            
	    <li role="separator" class="divider"></li>
            <li><a href="../aio/index.html">All in one page (Beta)</a></li>
          </ul>
        </li>
        
	

	
	
        <li class="dropdown">
          <a href="../" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">Extras <span class="caret"></span></a>
          <ul class="dropdown-menu">
            <li><a href="../reference.html">Reference</a></li>
            
            
            
              <li><a href="../about/index.html">About</a></li>
            
            
            
            
              <li><a href="../discuss/index.html">Discussion</a></li>
            
            
            
            
              <li><a href="../figures/index.html">Figures</a></li>
            
            
            
            
              <li><a href="../guide/index.html">Instructor Notes</a></li>
            
            
          </ul>
        </li>
	

	
        <li><a href="../LICENSE.html">License</a></li>
	
	
	<li><a href="/edit//_episodes_rmd/08-code-chunks.Rmd" data-checker-ignore>Improve this page <span class="glyphicon glyphicon-pencil" aria-hidden="true"></span></a></li>
	
	
      </ul>
      <form class="navbar-form navbar-right" role="search" id="search" onsubmit="google_search(); return false;">
        <div class="form-group">
          <input type="text" id="google-search" placeholder="Search..." aria-label="Google site search">
        </div>
      </form>
    </div>
  </div>
</nav>

      


<div class="alert alert-info text-center" role="alert">
  This lesson is part of
  <a href="https://github.com/carpentries-incubator/proposals/#the-carpentries-incubator" data-checker-ignore>
    The Carpentries Incubator</a>, a place to share and use each other's
  Carpentries-style lessons. <strong>This lesson has not been reviewed by and is
  not endorsed by The Carpentries</strong>.
</div>




      

















  
  











<div class="row">
  <div class="col-xs-1">
    <h3 class="text-left">
      
      <a href="../07-plots-figures/index.html"><span class="glyphicon glyphicon-menu-left" aria-hidden="true"></span><span class="sr-only">previous episode</span></a>
      
    </h3>
  </div>
  <div class="col-xs-10">
    
    <h3 class="maintitle"><a href="../">Introduction to Reproducible Publications with RStudio</a></h3>
    
  </div>
  <div class="col-xs-1">
    <h3 class="text-right">
      
      <a href="../09-biblio-crossref/index.html"><span class="glyphicon glyphicon-menu-right" aria-hidden="true"></span><span class="sr-only">next episode</span></a>
      
    </h3>
  </div>
</div>

<article>
<div class="row">
  <div class="col-md-1">
  </div>
  <div class="col-md-10">
    <h1 class="maintitle">Reproducible & Efficient Methods of Using Code Chunks</h1>
  </div>
  <div class="col-md-1">
  </div>
</div>












<blockquote class="objectives">
  <h2>Overview</h2>

  <div class="row">
    <div class="col-md-3">
      <strong>Teaching:</strong> 50 min
      <br/>
      <strong>Exercises:</strong> 20 min
    </div>
    <div class="col-md-9">
      <strong>Questions</strong>
      <ul>
	
	<li><p>How can I enhance reproducibility amongst collaborators, present and future?</p>
</li>
	
	<li><p>How do I run external scripts in an Quarto document?</p>
</li>
	
	<li><p>How can I avoid issues with relative paths?</p>
</li>
	
	<li><p>How can I get my Quarto document to render faster?</p>
</li>
	
	<li><p>What is inline code and when to use it?</p>
</li>
	
      </ul>
    </div>
  </div>

  <div class="row">
    <div class="col-md-3">
    </div>
    <div class="col-md-9">
      <strong>Objectives</strong>
      <ul>
	
	<li><p>Learn how to use renv in an RStudio project</p>
</li>
	
	<li><p>Learn how to source external scripts to run within an qmd document to modularize your code.</p>
</li>
	
	<li><p>Learn about using global knitr options to change your <code class="language-plaintext highlighter-rouge">.qmd</code> file’s working directory.</p>
</li>
	
	<li><p>Learn how to load libraries and data for use throughout the whole <code class="language-plaintext highlighter-rouge">.qmd</code> document.</p>
</li>
	
	<li><p>Learn the syntax for inline code.</p>
</li>
	
      </ul>
    </div>
  </div>

</blockquote>

<h2 id="reproducible-methods-for-coding-in-quarto">Reproducible Methods for Coding in Quarto</h2>

<p>Now that we’ve learned the core benefit of using Quarto documents - the integration of code with text - let’s learn some next level methods of working with code in Quarto. We’ll cover how to use virtual environments with renv, how to add Global Knitr options to the yaml, run external R scripts from within the Quarto document, setting the working directory for the Quarto document and loading packages and data globally. Whew! that’s a lot! Let’s dig in.</p>

<h2 id="enhancing-reproducibility-with-renv">Enhancing reproducibility with renv</h2>

<p>renv is an R package that keeps track of your project’s dependencies, specifically, the version of the R interpreter your project is using and the versions of any packages referenced by your R scripts.  renv can also download and install package versions according to a project’s requirements.  This makes it easy for a downstream user to run an R project in the same environment in which it was originally developed.</p>

<p>In our workshop project, renv has already been set up— you can tell by the presence of a file <code class="language-plaintext highlighter-rouge">renv.lock</code> in the project’s root directory.  This file records package versions and other information.</p>

<p>Every time you open a project for which renv has been set up, renv automatically runs and checks that the package versions you have installed on your computer match those of the project.  If they match, there is nothing to do (perhaps that was the case for you today).  But if there are any mismatches (as might have happened to you today), renv will print a warning resembling the following:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>* Project '~/Desktop/myproject' loaded. [renv 0.16.0]
* The project library is out of sync with the lockfile.
* Use `renv::restore()` to install packages recorded in the lockfile.
</code></pre></div></div>

<p>If this happens, simply run <code class="language-plaintext highlighter-rouge">renv::restore()</code> from the console pane to download and install the package versions needed to match the project’s requirements.  For example, if the project uses tidyverse 1.3.2 and you have an older version tidyverse 1.3.1 installed on your computer, renv will upgrade your RStudio installation to tidyverse 1.3.2.  (This works conversely as well: if the project uses an older version of a package you have installed, renv will attempt to download and install the older version for you.  Don’t worry about losing the newer version.  renv ensures that all versions of all packages remain installed on your computer, available to be used by projects as needed.)</p>

<p>A few more points on using renv.  To start using renv on a new project, run these commands in the console pane:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>install.packages("renv")
library(renv)
renv::init()
</code></pre></div></div>

<p>This creates the initial <code class="language-plaintext highlighter-rouge">renv.lock</code> file.  Then, whenever you start using a new package (or otherwise change your project’s dependencies), run <code class="language-plaintext highlighter-rouge">renv::snapshot()</code> to update the lockfile.  Finally, if you are using git and start using renv, you will notice that renv creates several files and directories in addition to <code class="language-plaintext highlighter-rouge">renv.lock</code>. For reproducibility, be sure to commit the <code class="language-plaintext highlighter-rouge">renv.lock</code> file, and also <code class="language-plaintext highlighter-rouge">.Rprofile</code> and <code class="language-plaintext highlighter-rouge">renv/activate.R</code>.</p>

<h2 id="global-quarto-options">Global Quarto Options</h2>

<p>We’ve seen that we have pretty fine-tuned control of how our code output looks in our document using code chunk options. Now, let’s learn how to take those controls to the next level by learning how to apply them “globally” over our whole document or even all the documents in your project.</p>

<p>What are some of features of global knitr options? There are many, but we’ll cover several of the most relevant and useful ones here:</p>
<ol>
  <li>Set global options for code chunks so we don’t have to repeat them in each chunk</li>
  <li>Set working directory so file paths (for code chunks) are easier to work with</li>
  <li>Load libraries and data once at the beginning of the document instead of in each code chunk (more concise and less rendering time)</li>
</ol>

<h3 id="project-level-vs-document-level-settings">Project level vs Document level settings</h3>

<p>With Quarto we have the functionality and flexibility of being able to define <em>project</em> level global settings in addition to <em>document</em> level settings. This means that the settings we choose will be applied to either one specific Quarto document or <em>all</em> Quarto documents within our R project.</p>

<p>How do we use document level settings?. How do we edit project level settings? That’s where the yaml at the top of our documents and/or the <code class="language-plaintext highlighter-rouge">_quarto.yml</code> file that lives in our project root directory comes in.</p>

<p>At the top of our .Qmd document we see the yaml:</p>

<p><img src="../fig/08-yaml-header.png" alt="Qmd yaml header" /></p>

<p>Opening the <code class="language-plaintext highlighter-rouge">_quarto.yml</code> file in our project root we see the following default settings:</p>

<p><img src="../fig/08-quarto.yml-new.png" alt="New Quarto yml file" /></p>

<h3 id="project-and-document-settings-hierarchy">Project and Document settings Hierarchy</h3>

<p>Similar to CSS, Quarto uses a cascading style of options. Starting from the project-level <code class="language-plaintext highlighter-rouge">_quart0.yml</code> document, Quarto gathers all specified options ending with the document-level options. All are combined and applied to the specific Quarto document. If there are any options that differ between the documents, the more specific option wins - i.e. the document-level option will be applied.</p>

<p><img src="../fig/08-cascading-options.png" alt="options hierarchy" /></p>

<h2 id="document-level-setting">Document level setting</h2>

<h3 id="global-code-chunk-options">Global Code Chunk Options:</h3>

<p>There is an option to globally set options for the entire Quarto document rather than have to specify in each code chunk. This is helpful when you consistently want to use the same options and when you have many code chunks within a document. Additionally, adding global code options will allow you and collaborators to have a better idea of how you’ve configured your document.</p>

<p>In Quarto, the way to configure global code chunk options is in the yaml header.</p>

<p>In the yaml header of our document we can set global options with <code class="language-plaintext highlighter-rouge">execute</code>.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>~~~
...
execute: 
      echo: false
~~~
</code></pre></div></div>

<p>Additional options can be further nested under execute.</p>

<p>Let’s see how it looks in our paper to add the options from our first code chunk:</p>

<p><img src="../fig/08-global-code-options.png" alt="global Quarto code options" /></p>

<blockquote class="callout">
  <h2 id="tip-r-markdown-global-options-syntax-works-in-quarto">Tip: R Markdown global options syntax works in Quarto</h2>
  <p>If you’ve previously used R Markdown and have old documents or don’t want to learn a new workflow quite yet, Quarto is backwards compatible with R Markdown, so you may also use the old <code class="language-plaintext highlighter-rouge">chunk$set</code> syntax as below:
<img src="../fig/07-setup-chunk.png" alt="R Markdown global code options" /></p>

</blockquote>

<blockquote class="callout">
  <h2 id="tip-overiding-global-options">Tip: Overiding global options</h2>
  <p>What if you want most of your code chunks to render with the same options (i.e. echo: false), but you just have one or two chunks that you want to tweak the options on (i.e. display code with echo: true)? Good news! The global options can be overwritten on a case by case basis in each individual code chunk. Test this by adding <code class="language-plaintext highlighter-rouge">#| echo: true</code> to your code chunk in your document and rendering. Did you override the global settings successfully?</p>
</blockquote>

<blockquote class="challenge">
  <h2 id="challenge-81-optional-global--individual-code-chunk-options">Challenge 8.1 (optional) global &amp; individual code chunk options</h2>

  <p>How would appear in our html document if we render a code chunk with the following options?</p>
  <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>{r} 
#| warning: true
#| echo: true
...
</code></pre></div>  </div>

  <p>…considering the global chunk settings were as listed:</p>
  <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>~~~
execute:
     echo: false
     include: false
~~~
</code></pre></div>  </div>
  <blockquote class="solution">
    <h2 id="solution">SOLUTION</h2>
    <p>In this case, the global settings are set so neither the code nor the output will display. However, the individual chunk reverses the echo setting so the code will display, and it also indicates that any warnings the code renders should output too. The outputs of the code would still not be displayed (include: false) The hypothetical situation for this configuration may be for debugging while writing the qmd document.</p>
  </blockquote>
</blockquote>

<h2 id="project-level-settings">Project level settings</h2>

<h3 id="set-working-directory-to-project-directory">Set working directory to project directory:</h3>

<p>Ok, so you know how we had to change the file path in the code chunk we copied into our document so that the relative path was correct for reading in data? This happened because in Quarto documents, the working directory is wherever the qmd document is located but our code is located in a different folder. This means they have different relative paths to locate and read the data we want to work with. We can simplify things by designating the working directory for our document relative to the root project directory instead. What this does is let all files work relative to the project root instead of each other, standardizing the relative paths. Note that this is mainly important for code chunks - text portions of Quarto documents are not affected. This will clear up some of our confusion with relative paths across our whole R project.</p>

<p>So one should learn how to accomplish that by changing the working directory at the project level yaml settings. So we’ll navigate to our _quarto.yml document in our root project directory and open it.</p>

<p>We’ll add the following settings to the yml file:</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>...
project: 
  execute-dir: project
...
</code></pre></div></div>

<p>So the yml file should now look something like this:</p>

<p><img src="../fig/08-quarto.yml-project.png" alt="Quarto yml project setting" /></p>

<blockquote class="callout">
  <h2 id="note-r-markdown-method-for-setting-working-directory-also-works-in-quarto">Note: R Markdown method for setting working directory also works in Quarto</h2>

  <p>Again, all R Markdown syntax is backward compatible with Quarto so it is possible to use the “old” method to set the working directory. This would be the workaround to set the working directory if you don’t wish to use the Quarto project <code class="language-plaintext highlighter-rouge">_quarto.yml</code> file.</p>

  <p>To simplify it further, one can use the <code class="language-plaintext highlighter-rouge">here</code> package available in RStudio.</p>

  <p>This is a setting option in  global knitr settings. The following code would be used in a code chunk at the top of your Quarto document:</p>

  <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>knitr::opts_knit$set(root.dir = here::here())
</code></pre></div>  </div>
</blockquote>

<p>Now, we would change the relative path in our code chunk back to what it was before, but let’s hold tight. We’re going to introduce another way to run code! But first, let’s see how to globally load data and packages.</p>

<blockquote class="callout">
  <h2 id="note-changing-the-working-directory-only-applies-to-code">Note: Changing the working directory only applies to code</h2>
  <p>Setting the working directory to the project directory we just did adjusts the working directory for all code in the Quarto document (code chunks and inline code), but NOT for any markdown text elements (images and hyperlinks).</p>
</blockquote>

<blockquote class="callout">
  <h2 id="tip-yaml-chunk-options">Tip: Yaml chunk options</h2>
  <p>We can also tweak some settings in our yaml which changes how code chunks are displayed. We’re not going to get into this in the workshop, but many of the same options you set in your global code chunk settings are also configurable in the yaml.</p>
</blockquote>

<h2 id="code-improvements">Code improvements</h2>

<h3 id="globally-load-data-and-packages">Globally load data and packages</h3>

<p>We can improve organization and rendering speed in our documents by learning how to globally load data and packages. So far we’ve loaded the library <code class="language-plaintext highlighter-rouge">tidyverse</code> and the data frame <code class="language-plaintext highlighter-rouge">df</code> we need in the first code chunk. Now if we want to add another figure (say the hormone analysis code ‘02_hormone_analysis.r`), which uses the same data as our first figure - we would be loading tidyverse and the data for a second time. This is unnecessary because once libraries and data are loaded in a Quarto document they are available for use in the rest of the code in the document following.</p>

<p>Best practice is to load libraries and data once at the beginning of our document making it available for all other figures or calculations throughout the document -  allowing us to avoid repetition in our code and saving us rendering time. This also makes it easier for us to keep track of all the libraries and data we need to use in any given document for ourselves and collaborators. If anything needs to be tweaked, we don’t need to search through every code chunk in our qmd document to make a change - it’s listed right at the top.</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># load libraries</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">tidyverse</span><span class="p">)</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">BayesFactor</span><span class="p">)</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">patchwork</span><span class="p">)</span><span class="w">

</span><span class="c1"># load data</span><span class="w">
</span><span class="n">df</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">read_csv</span><span class="p">(</span><span class="s2">"./output/data/preprocessed-GARP-TSST-data.csv"</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<blockquote class="challenge">
  <h2 id="challenge-82-order-matters-optional">Challenge 8.2: Order matters (optional)</h2>

  <p>What would happen if we loaded the data before we loaded the libraries?
Try it out!</p>

  <blockquote class="solution">
    <h2 id="solution-1">Solution:</h2>

    <p>We would get an error because we haven’t loaded tidyverse yet!
<img src="../fig/08-error-load-data.png" alt="load data error" /></p>
  </blockquote>
</blockquote>

<p>At this point we could go back through our R scripts and comment out (or delete) the beginning sections where we load the data and libraries (you will see this is already done in most of the scripts in the code folder). You can imagine that the more code chunks you have the more time taking this step would save. Bonus that this also works to load the data before it is called in inline code as well!</p>

<h2 id="run-code-from-an-external-script-in-a-code-chunk">Run Code from an external script in a code chunk</h2>

<p>Let’s learn another technique for adding code-generated plots and figures into our document. This time around let’s see how to run code in a code chunk from an external R script instead of somewhat awkwardly copying and pasting the code from a R script to a code chunk in our <code class="language-plaintext highlighter-rouge">.qmd</code>.</p>

<p>There are at least a few benefits to running code in this modular fashion instead of copy/pasting:</p>
<ol>
  <li>
    <p>Automatic updates: if the code gets updated in the R script, it will automatically be updated in the Quarto document as well. We won’t need to copy/paste code updates, which would make it easy to end up with discrepancies between our <code class="language-plaintext highlighter-rouge">.r</code> scripts and our <code class="language-plaintext highlighter-rouge">.qmd</code> paper.</p>
  </li>
  <li>
    <p>Readability: calling code externally only takes several lines of code - versus copy/pasting 50+ lines of code from our scripts.</p>
  </li>
  <li>
    <p>Less fussing with relative paths* - we had to change the code slightly in the first example to update the file path to the data set, which introduces variations and inconsistencies. With this method we won’t have to modify the source code.</p>
  </li>
</ol>

<p>*unfortunately you will never be free of relative paths, but you can make it a bit easier on yourself.</p>

<p>Again, let’s test this out in our generic Quarto document. After our first figure add a new code chunk:</p>

<p><img src="../fig/08-blank-code-chunk.png" alt="basic code chunk" /></p>

<p>We’re just going to test out the same figure again so we can verify this new method works. So in the heart rate anlysis code chunk, delete the existing code and add the following instead:</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># run the code from 03_HR_analysis.R in the code directory</span><span class="w">
</span><span class="n">source</span><span class="p">(</span><span class="s2">"code/03_HR_analysis.R"</span><span class="p">,</span><span class="w"> </span><span class="n">local</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">knitr</span><span class="o">::</span><span class="n">knit_global</span><span class="p">())</span><span class="w">
</span><span class="c1"># display the plot created by code in 03_HR_analysis.R</span><span class="w">
</span><span class="n">plot</span><span class="w"> 
</span></code></pre></div></div>

<h3 id="add-the-code-to-our-quarto-document">Add the code to our Quarto document</h3>

<p>First, find <code class="language-plaintext highlighter-rouge">Example 8</code> in the Quarto document for Fig 3 (ctrl-f “Example 8”).</p>

<p>Add the following code where <code class="language-plaintext highlighter-rouge">Example 8</code> is located under “Preview of Research Results”.</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># run the code from 03_HR_analysis.R in the code directory</span><span class="w">
</span><span class="n">source</span><span class="p">(</span><span class="s2">"code/03_HR_analysis.R"</span><span class="p">,</span><span class="w"> </span><span class="n">local</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">knitr</span><span class="o">::</span><span class="n">knit_global</span><span class="p">())</span><span class="w">
</span><span class="c1"># display the plot created by code in 03_HR_analysis.R</span><span class="w">
</span><span class="n">plot</span><span class="w"> 
</span></code></pre></div></div>

<p>It should look like this:</p>

<p><img src="../fig/08-HR-external-code.png" alt="03-HR-analysis.R externally sourced in Qmd Document" /></p>

<p>DON’T forget to add chunk name and caption for Figure 3 (we can use the same name and caption as before). Remember we don’t need to add options since we defined them globally.</p>

<blockquote class="checklist">
  <h2 id="time-to-run">Time to Run!</h2>
  <p>Let’s see if our code worked when generated from an external script</p>
</blockquote>

<blockquote class="checklist">
  <h2 id="time-to-render">Time to Render!</h2>
  <p>If the code ran without error, let’s render the whole document again and take a look.</p>
</blockquote>

<p>Our plot should look exactly the same as the first copy-pasted one.</p>

<p>Success! And you’ll notice that the global code chunk options were applied to this code chunk as well*.</p>

<ul>
  <li>Note: As of November 2022, Quarto has not implemented global options for <code class="language-plaintext highlighter-rouge">results</code>. This will need to be added to each code chunk if needed until further notice.</li>
</ul>

<blockquote class="callout">
  <h2 id="tip-many-ways-to-run-external-code">Tip: Many ways to run external code</h2>
  <p>There are at least 3-4 methods one can use to run external code, the best choice may just depend on the context or on your personal preference. There’s no method that’s a clear winner, because there’s an awkward quirk or another to each of them, but better than copy/pasting code from elsewhere in your project (in our humble opinion):</p>

  <ol>
    <li>source()   – <a href="https://bookdown.org/yihui/rmarkdown-cookbook/source-script.html">see more at bookdown.org</a></li>
    <li>sys.source()   – <a href="https://bookdown.org/yihui/rmarkdown-cookbook/source-script.html">see more at bookdown.org</a></li>
    <li>knitr::read_chunk()  – <a href="https://stackoverflow.com/a/52398016">see more at stackoverflow</a></li>
  </ol>

</blockquote>

<blockquote class="challenge">
  <h2 id="challenge-83-your-turn-create-figure-4-with-the-external-code">Challenge 8.3: Your turn! Create Figure 4 with the external code</h2>

  <p>First, find <code class="language-plaintext highlighter-rouge">Example 9</code> in the qmd document for Fig 4 (ctrl-f “Example 9”). We need to add the code for the hormone analysis.</p>

  <p>Make sure to give the code chunk a name: <code class="language-plaintext highlighter-rouge">fig4-hormones</code> and a caption: <code class="language-plaintext highlighter-rouge">"Fig 4: Cortisol and Amylase levels in stress and control groups"</code></p>

  <blockquote class="solution">
    <h2 id="solution-2">Solution:</h2>
    <div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="n">r</span><span class="p">}</span><span class="w">
</span><span class="c1">#| label: fig4-hormones</span><span class="w">
</span><span class="c1">#| fig.cap: "Fig 4: Cortisol and Amylase levels in stress and control groups"</span><span class="w">
</span><span class="c1"># run the code from 02_hormone_analysis.R in the code directory</span><span class="w">
</span><span class="n">source</span><span class="p">(</span><span class="s2">"code/02_hormone_analysis.R"</span><span class="p">,</span><span class="w"> </span><span class="n">local</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">knitr</span><span class="o">::</span><span class="n">knit_global</span><span class="p">())</span><span class="w">
</span><span class="c1"># display the plot created by code in 02_hormone_analysis.R</span><span class="w">
</span><span class="n">plot</span><span class="w"> 
</span></code></pre></div>    </div>
  </blockquote>
</blockquote>

<blockquote class="checklist">
  <h2 id="time-to-commit">Time to Commit!</h2>
  <p>Now, let’s commit the changes you have made.</p>
</blockquote>





<blockquote class="keypoints">
  <h2>Key Points</h2>
  <ul>
    
    <li><p>renv is a handy tool for capturing your project’s package dependencies</p>
</li>
    
    <li><p>Learn how to externally source code <code class="language-plaintext highlighter-rouge">source()</code></p>
</li>
    
    <li><p>Learn how to modularize your code to make it more reproducible</p>
</li>
    
    <li><p>There are options for changing the working directory of your <code class="language-plaintext highlighter-rouge">.qmd</code> document with package <code class="language-plaintext highlighter-rouge">rprojroot</code></p>
</li>
    
    <li><p>Use a chunk at the beginning of your document to load libraries and data globally to make your document more efficient.</p>
</li>
    
  </ul>
</blockquote>

</article>


















  
  











<div class="row">
  <div class="col-xs-1">
    <h3 class="text-left">
      
      <a href="../07-plots-figures/index.html"><span class="glyphicon glyphicon-menu-left" aria-hidden="true"></span><span class="sr-only">previous episode</span></a>
      
    </h3>
  </div>
  <div class="col-xs-10">
    
  </div>
  <div class="col-xs-1">
    <h3 class="text-right">
      
      <a href="../09-biblio-crossref/index.html"><span class="glyphicon glyphicon-menu-right" aria-hidden="true"></span><span class="sr-only">next episode</span></a>
      
    </h3>
  </div>
</div>



      
      






<footer>
  <hr/>
  <div class="row">
    <div class="col-md-6 license" id="license-info" align="left">
	
        Licensed under <a href="https://creativecommons.org/licenses/by/4.0/">CC-BY 4.0</a> 2023 by <a href="../CITATION">the authors</a>.
	
    </div>
    <div class="col-md-6 help-links" align="right">
	
	
	<a href="/edit//_episodes_rmd/08-code-chunks.Rmd" data-checker-ignore>Edit on GitHub</a>
	
	
	/
	<a href="/blob//CONTRIBUTING.md" data-checker-ignore>Contributing</a>
	/
	<a href="/">Source</a>
	/
	<a href="/blob//CITATION" data-checker-ignore>Cite</a>
	/
	<a href="mailto:team@carpentries.org">Contact</a>
    </div>
  </div>
  <p class="text-muted text-right">
    <small><i>Using <a href="https://github.com/carpentries/carpentries-theme/">The Carpentries theme</a> &mdash; Site last built on: 2023-03-13 20:02:32 +1100.</i></small>
  </p>
</footer>

      
    </div>
    
<script src="../assets/js/jquery.min.js"></script>
<script src="../assets/js/bootstrap.min.js"></script>
<script src="../assets/js/lesson.js"></script>


<!-- Matomo -->
<script>
  var _paq = window._paq = window._paq || [];
  /* tracker methods like "setCustomDimension" should be called before "trackPageView" */
  _paq.push(["setDocumentTitle", document.domain + "/" + document.title]);
  _paq.push(["setDomains", ["*.lessons.carpentries.org","*.datacarpentry.github.io","*.datacarpentry.org","*.librarycarpentry.github.io","*.librarycarpentry.org","*.swcarpentry.github.io"]]);
  _paq.push(["setDoNotTrack", true]);
  _paq.push(["disableCookies"]);
  _paq.push(['trackPageView']);
  _paq.push(['enableLinkTracking']);
  (function() {
    var u="https://carpentries.matomo.cloud/";
    _paq.push(['setTrackerUrl', u+'matomo.php']);
    _paq.push(['setSiteId', '1']);
    var d=document, g=d.createElement('script'), s=d.getElementsByTagName('script')[0];
    g.async=true; g.src='//cdn.matomo.cloud/carpentries.matomo.cloud/matomo.js'; s.parentNode.insertBefore(g,s);
  })();
</script>
<!-- End Matomo Code -->


<script src="../assets/js/anchor.min.js"></script>
<script>
    anchors.add();
</script>

  </body>
</html>
