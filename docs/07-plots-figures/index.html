






<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta http-equiv="last-modified" content="2023-03-13 20:02:32 +1100">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- meta "search-domain" used for google site search function google_search() -->
    <meta name="search-domain" value="">
    <link rel="stylesheet" type="text/css" href="../assets/css/bootstrap.css" />
    <link rel="stylesheet" type="text/css" href="../assets/css/bootstrap-theme.css" />
    <link rel="stylesheet" type="text/css" href="../assets/css/lesson.css" />
    <link rel="stylesheet" type="text/css" href="../assets/css/syntax.css" />
     <link rel="stylesheet" type="text/css" href="../assets/css/fonts.css" />
    
    <link rel="license" href="#license-info" />

    



    <!-- Favicons for everyone -->
    <link rel="apple-touch-icon-precomposed" sizes="57x57" href="../assets/favicons/incubator/apple-touch-icon-57x57.png" />
    <link rel="apple-touch-icon-precomposed" sizes="114x114" href="../assets/favicons/incubator/apple-touch-icon-114x114.png" />
    <link rel="apple-touch-icon-precomposed" sizes="72x72" href="../assets/favicons/incubator/apple-touch-icon-72x72.png" />
    <link rel="apple-touch-icon-precomposed" sizes="144x144" href="../assets/favicons/incubator/apple-touch-icon-144x144.png" />
    <link rel="apple-touch-icon-precomposed" sizes="60x60" href="../assets/favicons/incubator/apple-touch-icon-60x60.png" />
    <link rel="apple-touch-icon-precomposed" sizes="120x120" href="../assets/favicons/incubator/apple-touch-icon-120x120.png" />
    <link rel="apple-touch-icon-precomposed" sizes="76x76" href="../assets/favicons/incubator/apple-touch-icon-76x76.png" />
    <link rel="apple-touch-icon-precomposed" sizes="152x152" href="../assets/favicons/incubator/apple-touch-icon-152x152.png" />
    <link rel="icon" type="image/png" href="../assets/favicons/incubator/favicon-196x196.png" sizes="196x196" />
    <link rel="icon" type="image/png" href="../assets/favicons/incubator/favicon-96x96.png" sizes="96x96" />
    <link rel="icon" type="image/png" href="../assets/favicons/incubator/favicon-32x32.png" sizes="32x32" />
    <link rel="icon" type="image/png" href="../assets/favicons/incubator/favicon-16x16.png" sizes="16x16" />
    <link rel="icon" type="image/png" href="../assets/favicons/incubator/favicon-128.png" sizes="128x128" />
    <meta name="application-name" content="The Carpentries Incubator - Introduction to Reproducible Publications with RStudio"/>
    <meta name="msapplication-TileColor" content="#FFFFFF" />
    <meta name="msapplication-TileImage" content="../assets/favicons/incubator/mstile-144x144.png" />
    <meta name="msapplication-square70x70logo" content="../assets/favicons/incubator/mstile-70x70.png" />
    <meta name="msapplication-square150x150logo" content="../assets/favicons/incubator/mstile-150x150.png" />
    <meta name="msapplication-wide310x150logo" content="../assets/favicons/incubator/mstile-310x150.png" />
    <meta name="msapplication-square310x310logo" content="../assets/favicons/incubator/mstile-310x310.png" />


    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
	<script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
	<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
	<![endif]-->
  <title>
  Adding Code-Generated Plots and Figures &ndash; Introduction to Reproducible Publications with RStudio
  </title>

  </head>
  <body>
    







<div class="panel panel-default life-cycle">
  <div id="life-cycle" class="panel-body alpha">
    This lesson is in the early stages of development (Alpha version)
  </div>
</div>





    <div class="container">
      
















  
  










<nav class="navbar navbar-default">
  <div class="container-fluid">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>

      
      
      <a href="../index.html" class="pull-left">
        <img class="navbar-logo" src="../assets/img/incubator-logo-blue.svg" alt="The Carpentries Incubator logo" />
      </a>
      

      
      <a class="navbar-brand" href="../index.html">Home</a>

    </div>
    <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
      <ul class="nav navbar-nav">

	
        <li><a href="../CODE_OF_CONDUCT.html">Code of Conduct</a></li>

        
	
        <li><a href="../setup.html">Setup</a></li>

        
        
        <li class="dropdown">
          <a href="../" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">Episodes <span class="caret"></span></a>
          <ul class="dropdown-menu">
            
            
            <li><a href="../01-introduction/index.html">Scientific reproducibility: What is it for?</a></li>
            
            
            <li><a href="../02-basic-rstudio/index.html">Navigating RStudio and Quarto Documents</a></li>
            
            
            <li><a href="../03-quarto-documents/index.html">Introduction to Working with Quarto documents</a></li>
            
            
            <li><a href="../04-good-project/index.html">Good Practices for Managing Projects in RStudio</a></li>
            
            
            <li><a href="../05-setup-versioning/index.html">Getting Your project set up with Version Control in RStudio</a></li>
            
            
            <li><a href="../06-writing-styling/index.html">Writing and Styling Qmd Documents</a></li>
            
            
            <li><a href="../07-plots-figures/index.html">Adding Code-Generated Plots and Figures</a></li>
            
            
            <li><a href="../08-code-chunks/index.html">Reproducible & Efficient Methods of Using Code Chunks</a></li>
            
            
            <li><a href="../09-biblio-crossref/index.html">Bibliography, Citations & Cross-Referencing</a></li>
            
            
            <li><a href="../10-github/index.html">Collaborating via Github</a></li>
            
            
            <li><a href="../11-publishing-your-project/index.html">Publishing your project</a></li>
            
	    <li role="separator" class="divider"></li>
            <li><a href="../aio/index.html">All in one page (Beta)</a></li>
          </ul>
        </li>
        
	

	
	
        <li class="dropdown">
          <a href="../" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">Extras <span class="caret"></span></a>
          <ul class="dropdown-menu">
            <li><a href="../reference.html">Reference</a></li>
            
            
            
              <li><a href="../about/index.html">About</a></li>
            
            
            
            
              <li><a href="../discuss/index.html">Discussion</a></li>
            
            
            
            
              <li><a href="../figures/index.html">Figures</a></li>
            
            
            
            
              <li><a href="../guide/index.html">Instructor Notes</a></li>
            
            
          </ul>
        </li>
	

	
        <li><a href="../LICENSE.html">License</a></li>
	
	
	<li><a href="/edit//_episodes_rmd/07-plots-figures.Rmd" data-checker-ignore>Improve this page <span class="glyphicon glyphicon-pencil" aria-hidden="true"></span></a></li>
	
	
      </ul>
      <form class="navbar-form navbar-right" role="search" id="search" onsubmit="google_search(); return false;">
        <div class="form-group">
          <input type="text" id="google-search" placeholder="Search..." aria-label="Google site search">
        </div>
      </form>
    </div>
  </div>
</nav>

      


<div class="alert alert-info text-center" role="alert">
  This lesson is part of
  <a href="https://github.com/carpentries-incubator/proposals/#the-carpentries-incubator" data-checker-ignore>
    The Carpentries Incubator</a>, a place to share and use each other's
  Carpentries-style lessons. <strong>This lesson has not been reviewed by and is
  not endorsed by The Carpentries</strong>.
</div>




      

















  
  











<div class="row">
  <div class="col-xs-1">
    <h3 class="text-left">
      
      <a href="../06-writing-styling/index.html"><span class="glyphicon glyphicon-menu-left" aria-hidden="true"></span><span class="sr-only">previous episode</span></a>
      
    </h3>
  </div>
  <div class="col-xs-10">
    
    <h3 class="maintitle"><a href="../">Introduction to Reproducible Publications with RStudio</a></h3>
    
  </div>
  <div class="col-xs-1">
    <h3 class="text-right">
      
      <a href="../08-code-chunks/index.html"><span class="glyphicon glyphicon-menu-right" aria-hidden="true"></span><span class="sr-only">next episode</span></a>
      
    </h3>
  </div>
</div>

<article>
<div class="row">
  <div class="col-md-1">
  </div>
  <div class="col-md-10">
    <h1 class="maintitle">Adding Code-Generated Plots and Figures</h1>
  </div>
  <div class="col-md-1">
  </div>
</div>












<blockquote class="objectives">
  <h2>Overview</h2>

  <div class="row">
    <div class="col-md-3">
      <strong>Teaching:</strong> 50 min
      <br/>
      <strong>Exercises:</strong> 20 min
    </div>
    <div class="col-md-9">
      <strong>Questions</strong>
      <ul>
	
	<li><p>What is Knitr?</p>
</li>
	
	<li><p>What are code chunks and how they are structured?</p>
</li>
	
	<li><p>How can you run code from your Quarto document?</p>
</li>
	
	<li><p>What are global knitr options?</p>
</li>
	
	<li><p>What are global execution options?</p>
</li>
	
      </ul>
    </div>
  </div>

  <div class="row">
    <div class="col-md-3">
    </div>
    <div class="col-md-9">
      <strong>Objectives</strong>
      <ul>
	
	<li><p>Understand the syntax of a code chunk.</p>
</li>
	
	<li><p>Learn how to insert run-able chunks of code to integrate into your report</p>
</li>
	
	<li><p>Learn how to source external scripts to run within an Quarto document.</p>
</li>
	
	<li><p>Learn about using global knitr options and global execution options</p>
</li>
	
      </ul>
    </div>
  </div>

</blockquote>

<h2 id="utilizing-the-code-features-of-quarto">Utilizing the Code Features of Quarto</h2>

<p>We’ve learned about the text-formatting options of Quarto, now let’s dive into the code portion of Quarto documents. Quarto flips the defaults of code and text - instead of priortizing the code and making you comment out (#) text such as in R scripts, they priortize text and force you to specially comment the code portions. How do you signal to R the difference between code and text when you’re not using code commments (#)? That’s where code chunks (or “code chunks” as RStudio calls them) come into play. Instead of Quarto’s rendering system processing the markdown styling into the final output, Code chunks are sent to a preceding stage of processing by Knitr, which “knits”/render the code output and text together. Secondly, Quarto processes the code output and displays it in the document format of our choice - i.e. Knitr runs the lines of code for a plot in a code chunk, joins it to the markdown text portions, and Quarto outputs that as an html document.</p>

<h2 id="what-is-knitr">What is Knitr?</h2>

<p>But what is Knitr? Knitr is the engine in RStudio which creates the “dynamic” part of Quarto reports. It’s specifically a package that allows the integration of R code into the html, word, pdf, or LaTex document you have specified as your output for Quarto. It utilizes Literate Programming to make research more reproducible. There are two main ways to process code with Knitr in Quarto documents:</p>

<ol>
  <li>Code Chunks</li>
  <li>Inline Code</li>
</ol>

<p>First, we’re going to talk about code chunks for including substantial portions of code into our narrative such as to generate figures and plots. There are a plethora of options that become available to us when using code chunks so this tends to be the more complex part of Quarto documents. Now, sometimes you just need to do a quick calculation - like a count of total observations in your data or the mean of one of your variables. In those cases, it may not be worth setting up a code chunk to calculate those values, so after code chunks we will see how to add inline code - which allows one to add a quick line of code or single function to be executing within the text portion of the document. But let’s start with code chunks.</p>

<h2 id="inserting-code-chunks">Inserting Code Chunks</h2>

<p>Code chunks (also called “code blocks”) are the preferred option when you need to do something more sophisticated with your code than inline code, such as building plots or tables.  They also incorporate syntax which allows modifications to how that code is rendered and styled in your final output. We’ll learn more about that as we walk through the “anatomy” of a code chunk.</p>

<h3 id="start-a-new-qmd-file">Start a new .qmd File</h3>
<p>First, though, let’s open a new <code class="language-plaintext highlighter-rouge">.qmd</code> document to get a look at how code chunk work before integrating them into our paper.</p>

<p>Again, open a new document by navigating to <code class="language-plaintext highlighter-rouge">File &gt; New File &gt; Quarto Document</code>. Add the title <code class="language-plaintext highlighter-rouge">test-code</code>.</p>

<p>Let’s first delete the generic text because we don’t need it at this point (all except the first code chunk that is - we’ll get back to that in a second).</p>

<p><img src="../fig/07-empty-qmd-doc.png" alt="Default QMD just setup chunk" /></p>

<h3 id="basic-anatomy-of-a-code-chunk">Basic Anatomy of a Code Chunk</h3>

<p>You can quickly insert chunks like these into your file with:</p>
<ul>
  <li>the keyboard shortcut Ctrl + Alt + I (OS X: Cmd + Option + I)</li>
  <li>the Add Chunk command in the editor toolbar</li>
  <li>or by typing the code chunk delimiters {r} and ```.</li>
</ul>

<p>The most basic (empty) code chunk looks like so:</p>

<p><img src="../fig/08-blank-code-chunk.png" alt="blank qmd code chunk" /></p>

<p>Other than backticks ``` for code chunks that surround the code top and bottom, the only <strong>required</strong> piece is the specified language (r) placed between the curly brackets. This indicates that the language to read the code is R.</p>

<p>Let’s all start a new code chunk by typing our our starting backticks &amp; r between curly brackets. (in your own workflow you may want to add the ending three backticks as well so you don’t forget after adding your code - it’s a common mistake):</p>

<blockquote class="callout">
  <h2 id="fun-fact-other-programming-languages">Fun fact: Other Programming Languages</h2>
  <p>Although we will (mostly) be using R in this workshop, it’s possible to use other programming or markup languages. For example, we have seen that we can use LaTeX code for equations. You can also use python and a handful of other languages, so if R is not your preferred programming, but you like working in the RStudio environment, don’t despair! Other options for languages include: sql, julia, bash, and c, etc. It should be noted however, that some languages (like python) will require installing and loading additional packages.</p>
</blockquote>

<h2 id="add-a-code-chunk">Add a Code Chunk</h2>

<p>Ok, let’s add some code! There are already some plots included in our code but as static images. Now, we will add some additional plots, but generated straight from R code - which are also more reproducible and easier to update than static images. Using code to generated images directly assures us that if there are any changes to the data or code the plots will update automatically. We also don’t have to generate the new plots, save them as images, and then add them back in to our paper. Not only is this a time-saver, but it helps to prevent version errors as well!</p>

<p>Now, let’s open our <code class="language-plaintext highlighter-rouge">03_HR_analysis.R</code> script in our <code class="language-plaintext highlighter-rouge">code</code> folder. We will insert the code of this script into our current working file. To do this, copy the code and paste it in-between the two lines with backticks and <code class="language-plaintext highlighter-rouge">{r}</code>.</p>

<p><img src="../fig/07-heartrate-code.PNG" alt="heartrate code in chunk" /></p>

<blockquote class="callout">
  <h2 id="tip">Tip:</h2>
  <p>There’s actually a button you can use in the RStudio menu to generate the code chunks automatically. Automatic code chunk generation is available for several other languages as well. Also, you can use the keyboard shortcut <code class="language-plaintext highlighter-rouge">ctrl</code>+<code class="language-plaintext highlighter-rouge">alt</code>+<code class="language-plaintext highlighter-rouge">i</code> for Windows and <code class="language-plaintext highlighter-rouge">command</code>+<code class="language-plaintext highlighter-rouge">option</code>+<code class="language-plaintext highlighter-rouge">i</code> for Mac. 
<img src="../fig/07-auto-code-chunk.PNG" alt="auto create code chunk" /></p>
</blockquote>

<h2 id="run-the-code-in-a-code-chunk">Run the code in a code chunk</h2>
<p>Now, to check to make sure our code renders, we could click the “Render” button as we have been doing to check on the output of our Quarto file. However, with code chunks we have other options for running and debugging code that don’t require us to wait for the file to render.</p>

<p>1) Run from code chunk (green play button on the right top corner). This allows us to run one specific code chunk.</p>

<p><img src="../fig/07-run-from-chunk.png" alt="run from code chunk" /></p>

<p>2) Run menu - this gives more options for running code chunks (chunks) including the current one, the next one, all chunks, etc.</p>

<p><img src="../fig/07-run-options.png" alt="run code menu" /></p>

<p>3) Keyboard shortcuts:</p>

<table>
  <thead>
    <tr>
      <th><strong>Task</strong></th>
      <th><strong>Windows &amp; Linux</strong></th>
      <th><strong>macOS</strong></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>Create a code chunk</td>
      <td>Ctrl + Alt + I</td>
      <td>Cmd + Option + I</td>
    </tr>
    <tr>
      <td>Run all chunks above</td>
      <td>Ctrl+Alt+P</td>
      <td>Command+Option+P</td>
    </tr>
    <tr>
      <td>Run current chunk</td>
      <td>Ctrl+Alt+C</td>
      <td>Command+Option+C</td>
    </tr>
    <tr>
      <td>Run current chunk</td>
      <td>Ctrl+Shift+Enter</td>
      <td>Command+Shift+Enter</td>
    </tr>
    <tr>
      <td>Run next chunk</td>
      <td>Ctrl+Alt+N</td>
      <td>Command+Option+N</td>
    </tr>
    <tr>
      <td>Run all chunks</td>
      <td>Ctrl+Alt+R</td>
      <td>Command+Option+R</td>
    </tr>
    <tr>
      <td>Go to next chunk/title</td>
      <td>Ctrl+PgDown</td>
      <td>Command+PgDown</td>
    </tr>
    <tr>
      <td>Go to previous chunk/title</td>
      <td>Ctrl+PgUp</td>
      <td>Command+PgUp</td>
    </tr>
  </tbody>
</table>

<p>Run your code with one of the given methods.</p>

<p>Did it work? Look under the code chunk. You should now see a plot preview displayed beneath the code chunk if all went well.</p>

<p><img src="../fig/07-plot-preview.png" alt="Code Chunk Plot Preview" /></p>

<h2 id="rendering-code-chunks">Rendering Code Chunks</h2>

<p>We just saw how to run our code in our code chunks to see a preview of the code output that will render in our html document but to actually render it we need to use the Render button. Using the <code class="language-plaintext highlighter-rouge">Render</code> button with code chunks is a two step process - first the code is run (all code chunks will run automatically). Second, (if there are no code errors) the document of choice will render for our whole Quarto document.</p>

<blockquote class="checklist">
  <h2 id="time-to-render">Time to Render!</h2>
  <p>Now, let’s Render the Quarto file and see how our code output looks in the final html page.</p>
</blockquote>

<p><img src="../fig/07-render.png" alt="code chunk with plot1 code" /></p>

<p>Wait… what’s all that output in our document? We don’t want that in our paper!</p>

<p><img src="../fig/07-HR-output-no-options.PNG" alt="Heart rate code no options for code chunk" /></p>

<p>This happens because the output from running code (messages, results, warnings, etc.) get’s added to the Quarto document instead of being printed to the console. Let’s see about adjusting the output to make it look better with code chunk rendering options.</p>

<h2 id="code-chunk-options">Code Chunk Options</h2>

<p>There are over 50 different code chunk options!!! Obviously we will not go over all of them, but they fall into several larger categories including: code evaluation, text output, code style, cache options, plot output and animation. We’ll talk about a few options for code evaluation, text output and plot output specifically.</p>

<p>Code chunk options in Quarto are added within code chunks and always have the following format:</p>

<p><code class="language-plaintext highlighter-rouge">#| option: option-text</code></p>

<h3 id="common-code-chunk-options">Common code chunk options:</h3>

<p><strong>include</strong> = (logical) whether to include the chunk output in the output document (defaults to TRUE).<br />
<strong>eval</strong> = (logical or numeric) TRUE/FALSE to evaluate (or not) or a numeric value like c(1,3) (only evaluate expressions 1 and 3). <br />
<strong>echo</strong> =  (logical or numeric - following the same rules as above) whether to display source code or not.<br />
<strong>results</strong> = (logical or character) text output of the code can be hidden (hide or FALSE), or delineated in a certain way (default ‘markup’).     <br />
<strong>warning</strong> = (logical) whether to display the warnings in the output (default TRUE). FALSE will output warnings to the console only.     <br />
<strong>message</strong> = (logical) whether or not to display messages that appear when running the code (default TRUE).</p>

<h4 id="using-code-chunk-options-for-clean-quarto-documents">Using code chunk options for clean Quarto Documents</h4>

<p>Ok, let’s use some of the options above to improve the look of our Quarto document. Add the following options one-by-one to see how they change your output (click <code class="language-plaintext highlighter-rouge">Render</code> after each option you add):</p>

<ul>
  <li>echo: false</li>
  <li>message: false</li>
  <li>warning: false</li>
  <li>results: false</li>
</ul>

<p>These options mean the source code will not be printed in the rendered html document, messages from the code will not be printed in the rendered html document, and warnings will not be printed in the html document (but will still output to the console). Plots, figures or whatever is printed by the code WILL show up in the final html document.</p>

<p>Now we are seeing what we would like: a figure without other output to show in our paper.</p>

<blockquote class="challenge">
  <h2 id="challenge-71---rendering-codes-optional">CHALLENGE 7.1 - Rendering Codes (optional)</h2>
  <p>How will some hypothetical code render given the following options?</p>
  <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>{r}
#| label: global-chunk-challenge
#| eval = true
#| include = false
</code></pre></div>  </div>

  <blockquote class="solution">
    <h2 id="solution">SOLUTION</h2>
    <p>The expressions in the code chunk will be evaluated, but the outputed figures/plots will not be included in the rendered document. <br />
When might you want to use this? <br />
If you need to calculate some value or do something on your dataset for a further calucation or plot, but the output is not important to be included in your paper narrative.</p>
  </blockquote>
</blockquote>

<blockquote class="callout">
  <h2 id="tip-1">Tip:</h2>
  <p>Find a complete list of code chunk options on Knitr developer, Yihui Xie’s, <a href="https://yihui.org/knitr/options/">online guide to knitr</a>.</p>
</blockquote>

<h3 id="label-your-code-chunk">Label Your Code Chunk</h3>

<p>Before we get to fixing how our code output looks, let’s pause a second and give our code chunk a label. While not required for running your code, it is good practice is to give a name to each code chunk because a label is an unique identifier which allows for more advanced options (such as cross-referencing) to work with your qmd files later on:</p>

<p><img src="../fig/07-code-label.png" alt="code chun k label" /></p>

<p>Some things to keep in mind</p>
<ul>
  <li>The chunk label syntax is always <code class="language-plaintext highlighter-rouge">#| label: chunk-label</code> with <code class="language-plaintext highlighter-rouge">chunk-label</code> replaced with your own text</li>
  <li>The chunk label has to be unique (i.e. you can’t use the the same name for multiple chunks)</li>
</ul>

<p>We’ll see in a bit where this code chunk label comes in handy. But, for now let’s go back and give our first code chunk a name:</p>

<p><code class="language-plaintext highlighter-rouge">#| label: fig3-heartrate</code></p>

<blockquote class="callout">
  <h2 id="tip-dont-use-spaces-periods-or-underscores-in-code-chunk-labels">Tip: Don’t use spaces, periods or underscores in code chunk labels</h2>
  <p>Avoid spaces, periods <code class="language-plaintext highlighter-rouge">(.)</code>, and underscores <code class="language-plaintext highlighter-rouge">(_)</code> in chunk labels and paths. If you need separators, you are recommended to use hyphens <code class="language-plaintext highlighter-rouge">(-)</code> instead. For example, setup-options is a good label, whereas setup.options and chunk 1 are bad; fig.path = ‘figures/mcmc-‘ is a good path for figure output, and fig.path = ‘markov chain/monte carlo’ is bad. See more at: <a href="https://yihui.org/knitr/options/">https://yihui.org/knitr/options/</a></p>
</blockquote>

<h3 id="caption-your-code-chunk-output">Caption your code chunk output:</h3>

<p>The options we just looked at focus on code evaluation and text output. However, we have another set of options that deal with how plot or figure outputs look at act. Many of the options start with <code class="language-plaintext highlighter-rouge">fig</code>. The one we will use today allows us to add a caption to our figure. Again, this is an optional feature, but if you need (or want) to add captions to your publication, it is straightforward to do in code chunks.</p>

<p>The caption information also resides at the top of a code chunk using the <code class="language-plaintext highlighter-rouge">#|</code> syntax as such:</p>

<p><code class="language-plaintext highlighter-rouge">#| fig.cap: "Figure Caption Here"</code></p>

<p><strong>Don’t forget to put the caption within quotes <code class="language-plaintext highlighter-rouge">""</code>.</strong></p>

<blockquote class="challenge">
  <h2 id="challenge-72-add-a-caption-to-figure-3">CHALLENGE 7.2: Add a caption to Figure 3</h2>
  <p>Let’s add a caption to our heartrate figure. Add the caption:</p>

  <p>“Fig 3: Mean heart rate of stress and control groups at baseline and during intervention.”</p>
  <blockquote class="solution">
    <h2 id="solution-1">SOLUTION</h2>
    <p>so, you should end up with the following in your code chunk:</p>
    <div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="n">r</span><span class="p">}</span><span class="w">
</span><span class="c1">#| label: fig3-heartrate</span><span class="w">
</span><span class="c1">#| echo: false</span><span class="w">
</span><span class="c1">#| message: false</span><span class="w">
</span><span class="c1">#| warning: false</span><span class="w">
</span><span class="c1">#| results: false</span><span class="w">
</span><span class="c1">#| fig.cap: "Fig 3: Mean heart rate of stress and control groups at baseline and during intervention."</span><span class="w">
</span></code></pre></div>    </div>
    <p>Set the option <code class="language-plaintext highlighter-rouge">fig.cap</code> to equal the text in double quotes.</p>
  </blockquote>
</blockquote>

<h2 id="more-plotfigure-options">More plot/figure options</h2>
<blockquote class="callout">
  <p>Other options that change how a plot or figure appears often use the sytax <code class="language-plaintext highlighter-rouge">fig.xxx</code> similar to <code class="language-plaintext highlighter-rouge">fig.cap</code> Some other useful plot/figure code options include (From <a href="https://yihui.org/knitr/options/#plots">Yihui Xie’s page</a> ):</p>
  <ul>
    <li><code class="language-plaintext highlighter-rouge">fig.width</code>, <code class="language-plaintext highlighter-rouge">fig.height</code>: (both are 7; numeric) Width and height of the plot (in inches), to be used in the graphics device.</li>
    <li><code class="language-plaintext highlighter-rouge">out.width</code>, <code class="language-plaintext highlighter-rouge">out.height</code>: (NULL; character) Width and height of the plot in the output document, which can be different with its physical fig.width and fig.height, i.e., plots can be scaled in the output document.</li>
    <li><code class="language-plaintext highlighter-rouge">fig.align</code>: (‘default’; character) Alignment of figures in the output document. Possible values are default, left, right, and center. The default is not to make any alignment adjustments.</li>
    <li><code class="language-plaintext highlighter-rouge">fig.link</code>: (NULL; character) A link to be added onto the figure.</li>
    <li><code class="language-plaintext highlighter-rouge">fig.alt</code>: (NULL; character) The alternative text to be used in the alt attribute of the <img /> tags of figures in HTML output. By default, the chunk option fig.cap will be used as the alternative text if provided.</li>
  </ul>
</blockquote>

<p>Let’s render one more time to see if our figure outputs how we’d like and has a caption.</p>

<blockquote class="checklist">
  <h2 id="time-to-render-1">Time to Render!</h2>
  <p>Let’s try that again</p>
</blockquote>

<h2 id="add-the-code-to-our-paper">Add the code to our Paper</h2>

<p>We tested the code for our heart rate plot in a new qmd document to save time on rendering while we experimented with it (for our paper it can take 1-2 min to render and that adds up!). Now let’s add the code into our paper document. Navigate to <code class="language-plaintext highlighter-rouge">Example 8</code> and create a new code chunk. Copy and paste the code from the test document into the paper. Go ahead and run the code to make sure it works.</p>

<p>Well shoot! We’re getting an error:</p>

<p><img src="../fig/07-path-code-error.png" alt="directory error code chunk" /></p>

<p>If we go to the bottom of the code chunk we’ll see more details on the error:</p>

<p><img src="../fig/07-path-error-details.png" alt="path error details" /></p>

<p>This is a path error. The reason we’re seeing this is that our paper is located in the report directory while our test document was automatically created in the project root directory. The path from the report directory to the data we’re trying to read is not correct any longer.</p>

<p>We can fix this by adding the correct relative path:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>df &lt;- read_csv("../output/data/preprocessed-GARP-TSST-data.csv")
</code></pre></div></div>
<p>Instead of:</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>df &lt;- read_csv("output/data/preprocessed-GARP-TSST-data.csv")
</code></pre></div></div>

<p>Run the code again to make sure it works properly. Great! Let’s move on to inline code.</p>

<h2 id="inline-code">Inline Code</h2>

<p>What if you only need to make a quick calculation and adding a code chunk seems a little overkill?</p>

<p>You can directly include code into the text portion of your document with inline code, for example:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>There are ` r sum(1:14) ` cats in the neighbourhood
</code></pre></div></div>

<p>We’ve had to put an extra space between the backticks ` and the code to prevent it from rendering so you can understand how to write inline code. You can copy that line into the test-code.qmd document then remove the spaces. If we render the test-code.qmd document, what change do we see?</p>

<p>Say you are discussing some of the summary statistics in your manuscript, Quarto makes this possible through HTML/LaTeX inline code which allows you to calculate simple expressions integrated to your narrative. Inline code enables you to insert <code class="language-plaintext highlighter-rouge">r code</code> into your document to dynamically updated portions of your text. In other words, if your data set changes for any reason the code will automatically update the calculation specified.</p>

<p>This can be helpful when referring to specific variables on your data. For example, you should include numbers that are derived from the data as code not as numbers. Thus, rather than writing “The CSV file contains choice consistency data for 10.000 simulated participants” <strong>(Example 7)</strong> , replace the static number with a bit of code that, when evaluated, gives you a dynamic number if anything changes on your dataset. Note that there is not an insert option to do this from the menu in the visual editor, so we need to insert inline code manually with  <code class="language-plaintext highlighter-rouge">r</code>, for example:</p>

<p>The CSV file contains choice consistency data for <code class="language-plaintext highlighter-rouge">r nrow(bronars_simulation_data)</code> simulated participants.</p>

<p>When you render you might get an error. Any idea why? That is because we need to make sure to import the dataset we are referring to before the inline code can work. Let’s add the following to our chunk at the beginning of the document where we loaded our other data:</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">bronars_simulation_data</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">read_csv</span><span class="p">(</span><span class="s2">"data/bronars_simulation_data.csv"</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<blockquote class="checklist">
  <h2 id="time-to-render-2">Time to Render!</h2>
  <p>If you update your dataset this value will match the number of rows.</p>
</blockquote>

<blockquote class="challenge">
  <h2 id="challenge-73---adding-inline-code">CHALLENGE 7.3 - Adding inline code</h2>
  <p>Suppose we would like to add some information to the sentence we have just adjusted in our manuscript. We would like to include the average for the variable <em>violation_count</em> present in the same dataset. Which inline code we would have to add to following sentence?</p>

  <p>The CSV file contains choice consistency data for ` <code class="language-plaintext highlighter-rouge">r nrow(bronars_simulation_data.csv)</code> ` simulated participants, that have been used to determine the power of our food-choice task design to detect choice consistency violations, which averaged ` <code class="language-plaintext highlighter-rouge">enter inline code here</code> `. 
What inline code would you enter? What number would replace the inline code?</p>

  <p>Tip: we will need to use a <code class="language-plaintext highlighter-rouge">dataset$variable</code> syntax!</p>

  <blockquote class="solution">
    <h2 id="solution-2">Solution:</h2>
    <p>` <code class="language-plaintext highlighter-rouge">r mean(bronars_simulation_data$violation_count)</code> `
5.3924</p>
  </blockquote>
</blockquote>

<blockquote class="callout">
  <h2 id="important-note">Important Note:</h2>
  <p>Make sure the file you are calling is in the right subdirectory and your working directory is set appropriately.</p>

</blockquote>

<blockquote class="callout">
  <h2 id="more-on-inline-codes">More on inline codes:</h2>
  <p>Quarto will always display the results of inline code, but not the code. Inline expressions do not take knitr options.</p>

</blockquote>

<blockquote class="checklist">
  <h2 id="time-to-commit">Time to Commit!</h2>
  <p>Now, let’s commit the changes you have made.</p>
</blockquote>





<blockquote class="keypoints">
  <h2>Key Points</h2>
  <ul>
    
    <li><p>Knitr will render your code and markdown-formatted text and output your document format of choice</p>
</li>
    
    <li><p>Code chunks are runable piece of R code. Each time you render/knit the document, calculations and plots will be run and displayed</p>
</li>
    
    <li><p>Options for code chunks can be set at the individual level or at the global level</p>
</li>
    
  </ul>
</blockquote>

</article>


















  
  











<div class="row">
  <div class="col-xs-1">
    <h3 class="text-left">
      
      <a href="../06-writing-styling/index.html"><span class="glyphicon glyphicon-menu-left" aria-hidden="true"></span><span class="sr-only">previous episode</span></a>
      
    </h3>
  </div>
  <div class="col-xs-10">
    
  </div>
  <div class="col-xs-1">
    <h3 class="text-right">
      
      <a href="../08-code-chunks/index.html"><span class="glyphicon glyphicon-menu-right" aria-hidden="true"></span><span class="sr-only">next episode</span></a>
      
    </h3>
  </div>
</div>



      
      






<footer>
  <hr/>
  <div class="row">
    <div class="col-md-6 license" id="license-info" align="left">
	
        Licensed under <a href="https://creativecommons.org/licenses/by/4.0/">CC-BY 4.0</a> 2023 by <a href="../CITATION">the authors</a>.
	
    </div>
    <div class="col-md-6 help-links" align="right">
	
	
	<a href="/edit//_episodes_rmd/07-plots-figures.Rmd" data-checker-ignore>Edit on GitHub</a>
	
	
	/
	<a href="/blob//CONTRIBUTING.md" data-checker-ignore>Contributing</a>
	/
	<a href="/">Source</a>
	/
	<a href="/blob//CITATION" data-checker-ignore>Cite</a>
	/
	<a href="mailto:team@carpentries.org">Contact</a>
    </div>
  </div>
  <p class="text-muted text-right">
    <small><i>Using <a href="https://github.com/carpentries/carpentries-theme/">The Carpentries theme</a> &mdash; Site last built on: 2023-03-13 20:02:32 +1100.</i></small>
  </p>
</footer>

      
    </div>
    
<script src="../assets/js/jquery.min.js"></script>
<script src="../assets/js/bootstrap.min.js"></script>
<script src="../assets/js/lesson.js"></script>


<!-- Matomo -->
<script>
  var _paq = window._paq = window._paq || [];
  /* tracker methods like "setCustomDimension" should be called before "trackPageView" */
  _paq.push(["setDocumentTitle", document.domain + "/" + document.title]);
  _paq.push(["setDomains", ["*.lessons.carpentries.org","*.datacarpentry.github.io","*.datacarpentry.org","*.librarycarpentry.github.io","*.librarycarpentry.org","*.swcarpentry.github.io"]]);
  _paq.push(["setDoNotTrack", true]);
  _paq.push(["disableCookies"]);
  _paq.push(['trackPageView']);
  _paq.push(['enableLinkTracking']);
  (function() {
    var u="https://carpentries.matomo.cloud/";
    _paq.push(['setTrackerUrl', u+'matomo.php']);
    _paq.push(['setSiteId', '1']);
    var d=document, g=d.createElement('script'), s=d.getElementsByTagName('script')[0];
    g.async=true; g.src='//cdn.matomo.cloud/carpentries.matomo.cloud/matomo.js'; s.parentNode.insertBefore(g,s);
  })();
</script>
<!-- End Matomo Code -->


<script src="../assets/js/anchor.min.js"></script>
<script>
    anchors.add();
</script>

  </body>
</html>
